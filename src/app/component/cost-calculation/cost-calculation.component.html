<div class="container mt-4">
  <div style="text-align: center; margin: 70px;">
    <h2>Calcul du coût de production</h2>
  </div>

  <!-- Étape de saisie des catégories -->
  <div *ngIf="step < costCategories.length">
    <h4>{{ costCategories[step].name }}</h4>
    <form [formGroup]="costForm">
      <div *ngFor="let field of costCategories[step].fields">
        <label>{{ field }}</label>
        <input type="number" class="form-control" [formControlName]="sanitizeFieldName(field)">
      </div>
    </form>
    <button class="btn btn-outline-primary mt-3" (click)="previousStep()" *ngIf="step > 0">Retour</button>
    <button class="btn mt-3" (click)="skipStep()">Passer</button>
    <button class="btn btn-custom mt-3" (click)="nextStep()">Suivant</button>
  </div>  

  <!-- Dernière étape : Calcul du prix de vente -->
  <div *ngIf="step === costCategories.length">
    <h4>Finalisation</h4>
    <form [formGroup]="costForm">
      <label>Marge bénéficiaire (%)</label>
      <input type="number" class="form-control" formControlName="margeBeneficiaire">

      <label>Marge d'erreur (%)</label>
      <input type="number" class="form-control" formControlName="margeErreur">

      <label>Nombre total d'unités produites</label>
      <input type="number" class="form-control" formControlName="totalUnites">
    </form>
    <button class="btn btn-outline-primary mt-3" (click)="previousStep()">Retour</button>
    <button class="btn btn-custom mt-3" (click)="calculateCost()">Calculer</button>
  </div>

  <!-- Résultats finaux -->
  <div *ngIf="step === costCategories.length + 1">
    <h4>Résultats</h4>
    <p><strong>Coût total de production :</strong> {{ totalCost | number:'1.2-2' }} €</p>
    <p><strong>Coût unitaire :</strong> {{ unitCost | number:'1.2-2' }} €</p>
    <p><strong>Prix de vente recommandé :</strong> {{ suggestedPrice | number:'1.2-2' }} €</p>    
    <button class="btn btn-outline-primary mt-3" (click)="step = 0">Recommencer</button>
  </div>
</div>
